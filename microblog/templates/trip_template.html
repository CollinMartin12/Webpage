<div class="trip">
  <header>
      <div class="trip-picture-card">
          {% set city_name = trip.destination_city.name %}
          {% if city_images and city_name in city_images %}
            <img src="{{ city_images[city_name] }}" alt="{{ city_name }} Trip Picture">
          {% elif image_urls %}
            {% set idx = trip.id % (image_urls | length) %}
            <img src="{{ image_urls[idx] }}" alt="Trip Picture">
          {% else %}
            <img src="{{ url_for('static', filename='images/Barcelona Food Place.jpeg') }}" alt="Trip Picture">
          {% endif %}

      <div class="trip-top-left-corner">
        <div class="trip-status">
          {% if trip.is_finalized %}
            <span class="status-active">Finalized</span>
          {% elif trip.is_cancelled %}
            <span class="status-inactive">Cancelled</span>
          {% elif trip.is_open %}
            <span class="status-pending">Open</span>
          {% elif not trip.is_open %}
            <span class="status-closed">Closed</span>
          {% endif %}
    </div>

        <div class="trip-info-card">
          <span>Budget: {{ trip.budget }}</span>
        </div>
      </div>
    </div>
  </header>
  
  <div class="trip-info-card-under">
      <div class="trip-info-card-wrapper">
        <h2 class="trip-title">{{ trip.title }}</h2>
        <p class="trip-dates-card">
            {% if trip.definite_date %}
              {{ trip.definite_date.strftime('%b %d') }}
            {% elif trip.start_date and trip.end_date %}
              {{ trip.start_date.strftime('%b %d') }} - {{ trip.end_date.strftime('%b %d') }}
            {% elif trip.start_date %}
              {{ trip.start_date.strftime('%b %d') }}
            {% elif trip.end_date %}
              {{ trip.end_date.strftime('%b %d') }}
            {% else %}
              <span class="text-muted">Date TBD</span>
            {% endif %}
        </p>
      </div>
      <p class="trip-destination-card">Destination: {{ trip.destination_city.name }}</p>
      <p class="trip-description-card">Stops: {{ trip.stops | length }}</p>
       <div class="trip-participants-actions-row" style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
         <div class="trip-participants-row">
          {% if trip.participants | length > 0 and trip.participants != trip.max_participants %}
            <div class="participant-avatars">
               <div class="avatar-small">
                 <img src="{{ trip.participants[0].profile_picture or '/static/default-avatar.png' }}"
                      alt="{{ trip.participants[0].name }}">
              </div>
              {% if trip.participants | length > 1 %}
                 <span class="participant-count">+{{ trip.participants | length - 1 }}</span>
              {% endif %}
            </div>
          {% elif trip.participants == trip.max_participants %}
            <span>{{trip.max_participants}} / {{trip.max_participants}}</span>
          {% else %}
             <span>No participants yet</span>
          {% endif %}
         </div>
         <div class="trip-actions-btn">
          <a href="{{ url_for('main.trip', trip_id=trip.id) }}" class="btn btn--primary">View Details</a>
        </div>
      </div>
    </div>

</div>