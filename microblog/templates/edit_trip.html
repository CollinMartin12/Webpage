{% extends 'base.html' %}

{% block content %}
<div class ="trip-details-container">
    <main>
        <header>
            <h1>Editing Details</h1>
        </header>
        <form action =" {{ url_for('main.edit_trip', trip_id=trip.id) }} " method="post" novalidate>
        <div>
           {% set trip = trip %}
              <label for="destination_city_id">Destination City:</label>
              <select id="destination_city_id" name="destination_city_id" optional>
                <option value="">Select destination city</option>
                {% for city in cities %}
                    <option value="{{ city.id }}" {% if trip.destination_city and trip.destination_city.id == city.id %}selected{% endif %}>{{ city.name }}</option>
                {% endfor %}
              </select>
          <div>
            <label for="trip_type_id">Trip Type:</label>
              <select id="trip_type_id" name="trip_type_id" optional>
                <option value="">Select trip type</option>
                {% for trip_type in trip_types %}
                    <option value="{{ trip_type.id }}" {% if trip.trip_type and trip.trip_type.id == trip_type.id %}selected{% endif %}>{{ trip_type.name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class = "status">
                <label for="status">Status:</label>
                <select id="status" name="status" required>
                    <option value =""> Select status</option>
                    {% for trip_status in trip_statuses %}
                        <option value="{{ trip_status }}" {% if trip.status == trip_status %}selected{% endif %}>{{ trip_status }}</option>
                    {% endfor %}
                </select>

            </div>
            <div>
                <label for="departure_city_id">Departure City:</label>
                <select id="departure_city_id" name="departure_city_id">
                    <option value="">Select departure city</option>
                    {% for city in cities %}
                        <option value="{{ city.id }}" {% if trip.departure_city and trip.departure_city.id == city.id %}selected{% endif %}>{{ city.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="budget">Budget:</label>
            </div>
            <div>
                <input type="number" id="budget" name="budget" value="{{ trip.budget }}">
            </div>
            <div>
                <label for="max_participants">Max Participants:</label>
                <input type="number" id="max_participants" name="max_participants" value="{{ trip.max_participants }}">
            </div>
            <div>
                <label for ="description">About this Trip:</label>
                <textarea id="description" name="description" rows="4" maxlength="256" required>{{ trip.description }}</textarea>
            </div>

        <div class="trip-status">
            <label for="is_open">Trip Status:</label>
            <select id="is_open" name="is_open">
                <option value= 'True' {% if trip.is_open %}selected{% endif %}>Open</option>
                <option value= 'False' {% if not trip.is_open %} selected{% endif %}>Closed</option>
            </select>   
        </div>

        <div class = "form-actions">
            <button class="btn btn--primary" type="submit">Save changes</button>
        </div>

        </form>

        <div class="trip-actions">
            {% if is_creator %}
                <div class="editing-permissions-section">
                    <h4>Editing Permissions:</h4>
                    {% for participant in trip.participants %}
                        <div class="permission-item">
                            <label>
                                <input type="checkbox" 
                                       name="editing_permissions_{{ participant.user_id.id }}" 
                                       {% if participant.editing_permissions %}checked{% endif %}>
                                User {{ participant.user_id.name }} (ID: {{ participant.user_id.id }})
                            </label>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </main>


</div>
{% endblock %}
